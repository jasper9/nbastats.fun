<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>More - Nuggets Stats</title>
    {% if ga_tracking_id %}
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ ga_tracking_id }}"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', '{{ ga_tracking_id }}');
    </script>
    {% endif %}
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='45' fill='%23f85' stroke='%23333' stroke-width='3'/><path d='M50 5 v90 M5 50 h90 M15 20 Q50 50 15 80 M85 20 Q50 50 85 80' fill='none' stroke='%23333' stroke-width='3'/></svg>">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=Roboto:wght@400;500;700&display=swap');
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-card: #1c2128;
            --border: #30363d;
            --text-primary: #ffffff;
            --text-secondary: #b0b8c1;
            --text-muted: #6b7280;
            --nuggets-gold: #fec524;
            --nuggets-navy: #0d2240;
            --nuggets-red: #c4122e;
            --accent: var(--nuggets-gold);
            --positive: #34d399;
            --negative: #f87171;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        header {
            background: linear-gradient(135deg, var(--nuggets-navy) 0%, #1a3a5c 100%);
            text-align: center;
            padding: 30px 20px;
            border-bottom: 4px solid var(--nuggets-gold);
        }
        .page-title {
            font-family: 'Oswald', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--text-primary);
        }
        .back-link {
            color: var(--nuggets-gold);
            text-decoration: none;
            font-size: 0.9rem;
            margin-top: 8px;
            display: inline-block;
        }
        .back-link:hover { text-decoration: underline; }

        h2 {
            font-family: 'Oswald', sans-serif;
            font-size: 1.5rem;
            color: var(--nuggets-gold);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin: 30px 0 15px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--border);
        }

        /* Jokic Live Stats */
        .jokic-live {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .jokic-live-title {
            font-family: 'Oswald', sans-serif;
            font-size: 1.2rem;
            color: var(--text-muted);
            margin-bottom: 15px;
        }
        .jokic-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
        }
        .jokic-stat {
            text-align: center;
        }
        .jokic-stat-value {
            font-family: 'Oswald', sans-serif;
            font-size: 2rem;
            color: var(--nuggets-gold);
        }
        .jokic-stat-label {
            color: var(--text-muted);
            font-size: 0.8rem;
            text-transform: uppercase;
        }

        /* Recent Games */
        .games-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-card);
            border-radius: 8px;
            overflow: hidden;
        }
        .games-table th, .games-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        .games-table th {
            background: var(--bg-secondary);
            font-family: 'Oswald', sans-serif;
            font-size: 0.85rem;
            text-transform: uppercase;
            color: var(--text-muted);
        }
        .games-table tr:hover {
            background: var(--bg-secondary);
        }
        .result-badge {
            display: inline-block;
            padding: 2px 10px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 0.8rem;
        }
        .result-badge.W {
            background: #166534;
            color: #22c55e;
        }
        .result-badge.L {
            background: #991b1b;
            color: #fca5a5;
        }
        .quarter-scores {
            color: var(--text-muted);
            font-size: 0.8rem;
        }

        /* Roster */
        .roster-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 12px;
        }
        .player-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.2s;
        }
        .player-card:hover {
            border-color: var(--nuggets-gold);
        }
        .player-card.injured {
            border-left: 3px solid var(--nuggets-red);
        }
        .player-jersey {
            font-family: 'Oswald', sans-serif;
            font-size: 2rem;
            color: var(--nuggets-gold);
            min-width: 50px;
            text-align: center;
        }
        .player-info {
            flex: 1;
        }
        .player-name {
            font-weight: bold;
            font-size: 1.1rem;
        }
        .player-details {
            color: var(--text-muted);
            font-size: 0.85rem;
        }
        .injured-badge {
            background: var(--nuggets-red);
            color: white;
            font-size: 0.65rem;
            padding: 2px 6px;
            border-radius: 3px;
            text-transform: uppercase;
            font-weight: bold;
            margin-left: 8px;
        }
        .extended-badge {
            background: linear-gradient(135deg, #2e7d32, #4caf50);
            color: white;
            font-size: 0.6rem;
            padding: 2px 6px;
            border-radius: 3px;
            text-transform: uppercase;
            font-weight: bold;
            margin-left: 6px;
        }
        .player-contract {
            font-size: 0.75rem;
            color: #64b5f6;
            margin-top: 4px;
        }
        .player-contract.two-way {
            color: var(--text-muted);
            font-style: italic;
        }
        .player-contract.expiring {
            color: #ffa726;
        }
        .expiring-badge {
            display: inline-block;
            background: #ff9800;
            color: #000;
            font-size: 0.6rem;
            padding: 1px 5px;
            border-radius: 3px;
            text-transform: uppercase;
            font-weight: bold;
            margin-left: 6px;
            vertical-align: middle;
        }

        .footer {
            text-align: center;
            padding: 30px;
            color: var(--text-muted);
            font-size: 0.8rem;
            margin-top: 40px;
            border-top: 1px solid var(--border);
        }

        /* Contracts Table */
        .contracts-table .player-meta {
            color: var(--text-muted);
            font-size: 0.8rem;
            margin-left: 8px;
        }
        .contracts-table .salary {
            font-family: 'Oswald', sans-serif;
            font-size: 1.2rem;
            color: var(--nuggets-gold);
            white-space: nowrap;
        }
        .contracts-table .total-value {
            font-family: 'Oswald', sans-serif;
            font-size: 1.1rem;
            color: #8bc34a;
            white-space: nowrap;
        }
        .contracts-table .contract-years {
            display: block;
            font-size: 0.75rem;
            color: var(--text-muted);
            font-family: 'Inter', sans-serif;
        }
        .contracts-table .contract-details {
            line-height: 1.6;
        }
        .contracts-table .contract-type {
            font-weight: 600;
            color: #fff;
        }
        .contracts-table .signed-using {
            color: var(--text-muted);
            font-size: 0.8rem;
        }
        .contracts-table .contract-duration {
            font-size: 0.85rem;
            margin-top: 4px;
        }
        .contracts-table .free-agent-info {
            font-size: 0.8rem;
            color: #64b5f6;
            margin-top: 2px;
        }
        .notes-row {
            background: var(--bg-secondary) !important;
        }
        .notes-row:hover {
            background: var(--bg-secondary) !important;
        }
        .contract-notes {
            margin: 0;
            padding-left: 20px;
            color: var(--text-muted);
            font-size: 0.8rem;
        }
        .contract-notes li {
            margin: 2px 0;
        }
        .extension-badge {
            display: inline-block;
            background: linear-gradient(135deg, #2e7d32, #4caf50);
            color: white;
            font-size: 0.65rem;
            padding: 2px 8px;
            border-radius: 10px;
            text-transform: uppercase;
            font-weight: bold;
            margin-left: 8px;
            vertical-align: middle;
        }
        .extension-row {
            background: linear-gradient(90deg, rgba(46, 125, 50, 0.15), rgba(46, 125, 50, 0.05)) !important;
        }
        .extension-row:hover {
            background: linear-gradient(90deg, rgba(46, 125, 50, 0.2), rgba(46, 125, 50, 0.1)) !important;
        }
        .extension-info {
            padding: 10px 15px;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        .extension-label {
            color: #4caf50;
            font-weight: bold;
            margin-right: 8px;
        }
        .extension-value {
            color: #8bc34a;
            font-family: 'Oswald', sans-serif;
            font-size: 1.1rem;
        }
        .effective-dates {
            margin-top: 5px;
            color: #81c784;
            font-size: 0.85rem;
        }

        /* Salary Cap Section */
        .salary-cap-section {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
        }
        .cap-overview {
            text-align: center;
            margin-bottom: 25px;
        }
        .cap-total {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        .cap-label {
            font-size: 0.85rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .cap-amount {
            font-family: 'Oswald', sans-serif;
            font-size: 2.5rem;
            color: var(--nuggets-gold);
        }
        .cap-roster {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        /* Single bar visualization */
        .cap-visual {
            margin: 30px 0;
        }
        .cap-bar-container {
            position: relative;
            height: 50px;
            background: linear-gradient(90deg, #1a472a 0%, #2d5a3d 70%, #4a3a2a 85%, #5a2a2a 95%, #6a1a3a 100%);
            border-radius: 8px;
            margin-bottom: 60px;
        }
        .team-payroll-bar {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: var(--nuggets-gold);
            border-radius: 8px 0 0 8px;
            opacity: 0.9;
        }

        /* Threshold markers */
        .threshold-marker {
            position: absolute;
            top: 0;
            height: 100%;
            transform: translateX(-50%);
        }
        .marker-line {
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 3px;
            height: calc(100% + 16px);
            border-radius: 2px;
        }
        .cap-marker .marker-line { background: #4caf50; }
        .tax-marker .marker-line { background: #ff9800; }
        .apron1-marker .marker-line { background: #f44336; }
        .apron2-marker .marker-line { background: #9c27b0; }

        .marker-label {
            position: absolute;
            top: calc(100% + 12px);
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.7rem;
            color: var(--text-muted);
            text-align: center;
            white-space: nowrap;
            line-height: 1.3;
        }
        .cap-marker .marker-label { color: #4caf50; }
        .tax-marker .marker-label { color: #ff9800; }
        .apron1-marker .marker-label { color: #f44336; }
        .apron2-marker .marker-label { color: #9c27b0; }

        /* Team position marker */
        .team-marker {
            position: absolute;
            top: 0;
            height: 100%;
            transform: translateX(-50%);
            z-index: 10;
        }
        .team-marker-line {
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: calc(100% + 24px);
            background: #fff;
            border-radius: 2px;
            box-shadow: 0 0 8px rgba(255,255,255,0.5);
        }
        .team-marker-label {
            position: absolute;
            bottom: calc(100% + 16px);
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.75rem;
            font-weight: 600;
            color: #fff;
            text-align: center;
            white-space: nowrap;
            line-height: 1.3;
            background: var(--nuggets-blue);
            padding: 4px 8px;
            border-radius: 4px;
        }

        /* Status summary grid */
        .cap-status-summary {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }
        .status-item {
            text-align: center;
            padding: 10px;
            background: var(--bg-card);
            border-radius: 6px;
        }
        .status-label {
            display: block;
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 5px;
        }
        .status-value {
            display: block;
            font-size: 0.85rem;
            font-weight: 600;
        }
        .status-item.over .status-value { color: #f44336; }
        .status-item.under .status-value { color: #4caf50; }

        .cap-source {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
            font-size: 0.75rem;
            color: var(--text-muted);
            text-align: center;
        }

        @media (max-width: 700px) {
            .cap-status-summary {
                grid-template-columns: repeat(2, 1fr);
            }
            .marker-label {
                font-size: 0.6rem;
            }
        }

        /* Contract Glossary */
        .contract-glossary {
            margin-top: 40px;
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        .contract-glossary h3 {
            color: var(--nuggets-gold);
            margin: 0 0 15px 0;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .contract-glossary dl {
            margin: 0;
            columns: 2;
            column-gap: 40px;
        }
        .contract-glossary dt {
            font-weight: 600;
            color: #fff;
            font-size: 0.85rem;
            margin-bottom: 2px;
            break-after: avoid;
        }
        .contract-glossary dd {
            margin: 0 0 15px 0;
            color: var(--text-muted);
            font-size: 0.8rem;
            line-height: 1.4;
            break-inside: avoid;
        }
        @media (max-width: 800px) {
            .contract-glossary dl {
                columns: 1;
            }
        }
        /* Navigation */
        nav {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 0 20px;
        }
        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .nav-brand {
            font-family: 'Oswald', sans-serif;
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--nuggets-gold);
            text-decoration: none;
            padding: 15px 0;
        }
        .nav-links {
            display: flex;
            gap: 5px;
        }
        .nav-links a {
            color: var(--text-secondary);
            text-decoration: none;
            padding: 15px 15px;
            font-size: 0.9rem;
            transition: all 0.2s;
            border-bottom: 2px solid transparent;
        }
        .nav-links a:hover {
            color: var(--text-primary);
        }
        .nav-links a.active {
            color: var(--nuggets-gold);
            border-bottom-color: var(--nuggets-gold);
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-container">
            <a href="/" class="nav-brand">NBA Stats . Fun</a>
            <div class="nav-links">
                <a href="/">Home</a>
                <a href="/jokic">Jokiƒá</a>
                <a href="/more" class="active">Nuggets</a>
            </div>
        </div>
    </nav>

    <header>
        <div class="page-title">Denver Nuggets Stats</div>
    </header>

    <div class="container">
        {% if jokic_stats %}
        <h2>Jokic 2025-26 Season Averages</h2>
        <div class="jokic-live">
            <div class="jokic-stats-grid">
                <div class="jokic-stat">
                    <div class="jokic-stat-value">{{ "%.1f"|format(jokic_stats.pts or 0) }}</div>
                    <div class="jokic-stat-label">PPG</div>
                </div>
                <div class="jokic-stat">
                    <div class="jokic-stat-value">{{ "%.1f"|format(jokic_stats.reb or 0) }}</div>
                    <div class="jokic-stat-label">RPG</div>
                </div>
                <div class="jokic-stat">
                    <div class="jokic-stat-value">{{ "%.1f"|format(jokic_stats.ast or 0) }}</div>
                    <div class="jokic-stat-label">APG</div>
                </div>
                <div class="jokic-stat">
                    <div class="jokic-stat-value">{{ "%.1f"|format(jokic_stats.stl or 0) }}</div>
                    <div class="jokic-stat-label">SPG</div>
                </div>
                <div class="jokic-stat">
                    <div class="jokic-stat-value">{{ "%.1f"|format(jokic_stats.blk or 0) }}</div>
                    <div class="jokic-stat-label">BPG</div>
                </div>
                <div class="jokic-stat">
                    <div class="jokic-stat-value">{{ "%.1f"|format((jokic_stats.fg_pct or 0) * 100) }}%</div>
                    <div class="jokic-stat-label">FG%</div>
                </div>
                <div class="jokic-stat">
                    <div class="jokic-stat-value">{{ "%.1f"|format((jokic_stats.fg3_pct or 0) * 100) }}%</div>
                    <div class="jokic-stat-label">3P%</div>
                </div>
                <div class="jokic-stat">
                    <div class="jokic-stat-value">{{ jokic_stats.games_played or 0 }}</div>
                    <div class="jokic-stat-label">Games</div>
                </div>
            </div>
        </div>
        {% endif %}

        {% if recent_games %}
        <h2>Recent Games</h2>
        <table class="games-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Opponent</th>
                    <th>Result</th>
                    <th>Score</th>
                    <th>Quarters</th>
                </tr>
            </thead>
            <tbody>
                {% for game in recent_games %}
                <tr>
                    <td>{{ game.date }}</td>
                    <td>{{ '@' if not game.is_home else 'vs' }} {{ game.opponent }}</td>
                    <td><span class="result-badge {{ game.result }}">{{ game.result }}</span></td>
                    <td>{{ game.nuggets_score }} - {{ game.opponent_score }}</td>
                    <td class="quarter-scores">
                        {% if game.is_home %}
                        {{ game.home_q1 }}-{{ game.visitor_q1 }} | {{ game.home_q2 }}-{{ game.visitor_q2 }} | {{ game.home_q3 }}-{{ game.visitor_q3 }} | {{ game.home_q4 }}-{{ game.visitor_q4 }}{% if game.home_ot1 %} | OT: {{ game.home_ot1 }}-{{ game.visitor_ot1 }}{% endif %}
                        {% else %}
                        {{ game.visitor_q1 }}-{{ game.home_q1 }} | {{ game.visitor_q2 }}-{{ game.home_q2 }} | {{ game.visitor_q3 }}-{{ game.home_q3 }} | {{ game.visitor_q4 }}-{{ game.home_q4 }}{% if game.visitor_ot1 %} | OT: {{ game.visitor_ot1 }}-{{ game.home_ot1 }}{% endif %}
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}

        {% if roster %}
        <h2>Nuggets Roster</h2>
        <div class="roster-grid">
            {% for player in roster %}
            <div class="player-card {{ 'injured' if player.is_injured else '' }}">
                <div class="player-jersey">#{{ player.jersey }}</div>
                <div class="player-info">
                    <div class="player-name">
                        {{ player.name }}
                        {% if player.is_injured %}<span class="injured-badge">Injured</span>{% endif %}
                        {% if player.has_extension %}<span class="extended-badge">Extended</span>{% endif %}
                    </div>
                    <div class="player-details">
                        {{ player.position }} | {{ player.height }} | {{ player.weight }} lbs
                    </div>
                    <div class="player-details">
                        {% if player.college %}{{ player.college }}{% endif %}
                        {% if player.draft_year %} | {{ player.draft_year }} Draft (Rd {{ player.draft_round }}, #{{ player.draft_number }}){% endif %}
                    </div>
                    {% if player.contract_end %}
                    <div class="player-contract {{ 'expiring' if player.contract_end == 2026 else '' }}">
                        üìÑ Under contract thru {{ player.contract_end }} ¬∑ {{ player.free_agent_status or 'UFA' }} {{ player.free_agent_year or player.contract_end }}
                        {% if player.contract_end == 2026 %}<span class="expiring-badge">Expiring</span>{% endif %}
                    </div>
                    {% else %}
                    <div class="player-contract two-way">No standard contract on file</div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        {% if salary_cap %}
        <h2>Team Salary Cap Status</h2>
        <div class="salary-cap-section">
            <div class="cap-overview">
                <div class="cap-total">
                    <span class="cap-label">Total Team Cap Hit</span>
                    <span class="cap-amount">${{ "{:,.0f}".format(salary_cap.team_total_cap_hit) }}</span>
                    <span class="cap-roster">{{ salary_cap.roster_count }} players</span>
                </div>
            </div>

            <div class="cap-visual">
                {% set total = salary_cap.team_total_cap_hit %}
                {% set thresholds = salary_cap.thresholds %}
                {% set max_val = thresholds.second_apron * 1.05 %}

                <div class="cap-bar-container">
                    <!-- Team payroll bar -->
                    <div class="team-payroll-bar" style="width: {{ (total / max_val * 100) }}%"></div>

                    <!-- Threshold markers -->
                    <div class="threshold-marker cap-marker" style="left: {{ (thresholds.salary_cap / max_val * 100) }}%">
                        <div class="marker-line"></div>
                        <div class="marker-label">Cap<br>${{ "{:.0f}".format(thresholds.salary_cap / 1000000) }}M</div>
                    </div>
                    <div class="threshold-marker tax-marker" style="left: {{ (thresholds.luxury_tax_line / max_val * 100) }}%">
                        <div class="marker-line"></div>
                        <div class="marker-label">Tax<br>${{ "{:.0f}".format(thresholds.luxury_tax_line / 1000000) }}M</div>
                    </div>
                    <div class="threshold-marker apron1-marker" style="left: {{ (thresholds.first_apron / max_val * 100) }}%">
                        <div class="marker-line"></div>
                        <div class="marker-label">1st Apron<br>${{ "{:.0f}".format(thresholds.first_apron / 1000000) }}M</div>
                    </div>
                    <div class="threshold-marker apron2-marker" style="left: {{ (thresholds.second_apron / max_val * 100) }}%">
                        <div class="marker-line"></div>
                        <div class="marker-label">2nd Apron<br>${{ "{:.0f}".format(thresholds.second_apron / 1000000) }}M</div>
                    </div>

                    <!-- Team position indicator -->
                    <div class="team-marker" style="left: {{ (total / max_val * 100) }}%">
                        <div class="team-marker-line"></div>
                        <div class="team-marker-label">Nuggets<br>${{ "{:.1f}".format(total / 1000000) }}M</div>
                    </div>
                </div>
            </div>

            <!-- Status summary -->
            <div class="cap-status-summary">
                <div class="status-item {{ 'over' if salary_cap.over_cap else 'under' }}">
                    <span class="status-label">Salary Cap</span>
                    <span class="status-value">{{ 'Over' if salary_cap.over_cap else 'Under' }} ${{ "{:,.0f}".format(salary_cap.over_cap_amount if salary_cap.over_cap else salary_cap.cap_space) }}</span>
                </div>
                <div class="status-item {{ 'over' if salary_cap.over_tax else 'under' }}">
                    <span class="status-label">Luxury Tax</span>
                    <span class="status-value">{{ 'Over' if salary_cap.over_tax else 'Under' }} ${{ "{:,.0f}".format(salary_cap.over_tax_amount if salary_cap.over_tax else salary_cap.tax_space) }}</span>
                </div>
                <div class="status-item {{ 'over' if salary_cap.over_first_apron else 'under' }}">
                    <span class="status-label">First Apron</span>
                    <span class="status-value">{{ 'Over' if salary_cap.over_first_apron else 'Under' }} ${{ "{:,.0f}".format(salary_cap.first_apron_amount if salary_cap.over_first_apron else salary_cap.first_apron_space) }}</span>
                </div>
                <div class="status-item {{ 'over' if salary_cap.over_second_apron else 'under' }}">
                    <span class="status-label">Second Apron</span>
                    <span class="status-value">{{ 'Over' if salary_cap.over_second_apron else 'Under' }} ${{ "{:,.0f}".format(salary_cap.second_apron_amount if salary_cap.over_second_apron else salary_cap.second_apron_space) }}</span>
                </div>
            </div>

            <div class="cap-source">
                {{ thresholds.cap_thresholds_season }} thresholds from {{ thresholds.cap_thresholds_source }} (retrieved {{ thresholds.cap_thresholds_retrieved }})
            </div>
        </div>
        {% endif %}

        {% if contracts %}
        <h2>Team Contracts</h2>
        <table class="games-table contracts-table">
            <thead>
                <tr>
                    <th>Player</th>
                    <th>2025-26 Salary</th>
                    <th>Total Value</th>
                    <th>Contract Details</th>
                </tr>
            </thead>
            <tbody>
                {% for contract in contracts %}
                <tr>
                    <td>
                        <strong>{{ contract.name }}</strong>
                        <span class="player-meta">#{{ contract.jersey }} {{ contract.position }}</span>
                        {% if contract.has_extension %}<span class="extension-badge">Extended</span>{% endif %}
                    </td>
                    <td class="salary">${{ "{:,.0f}".format(contract.current_salary) }}</td>
                    <td class="total-value">
                        ${{ "{:,.0f}".format(contract.total_value) }}
                        <span class="contract-years">{{ contract.contract_years or '-' }} years</span>
                    </td>
                    <td class="contract-details">
                        <div class="contract-type">{{ contract.contract_type or '-' }}</div>
                        {% if contract.signed_using %}<div class="signed-using">Signed via {{ contract.signed_using }}</div>{% endif %}
                        <div class="contract-duration">
                            <strong>{{ contract.start_year }}-{{ contract.end_year }}</strong>
                            &nbsp;¬∑&nbsp; Expires after {{ contract.end_year - 1 }}-{{ '%02d' % (contract.end_year % 100) }} season
                        </div>
                        <div class="free-agent-info">
                            {{ contract.free_agent_status or 'UFA' }} in {{ contract.free_agent_year or contract.end_year }}
                        </div>
                    </td>
                </tr>
                {% if contract.has_extension %}
                <tr class="extension-row">
                    <td colspan="4">
                        <div class="extension-info">
                            <span class="extension-label">üìù SIGNED EXTENSION:</span>
                            <strong>{{ contract.extension.contract_type }}</strong> ¬∑
                            {{ contract.extension.start_year }}-{{ contract.extension.end_year }} ({{ contract.extension.contract_years }} yrs) ¬∑
                            <span class="extension-value">${{ "{:,.0f}".format(contract.extension.total_value) }}</span>
                            (${{ "{:,.0f}".format(contract.extension.average_salary) }}/yr)
                            {% if contract.extension.signed_using %} ¬∑ via {{ contract.extension.signed_using }}{% endif %}
                            <div class="effective-dates">
                                ‚Üí Effectively under contract through {{ contract.effective_end_year }} ¬∑ {{ contract.effective_fa_status or 'UFA' }} in {{ contract.effective_fa_year }}
                            </div>
                        </div>
                    </td>
                </tr>
                {% if contract.extension.contract_notes %}
                <tr class="notes-row">
                    <td colspan="4">
                        <ul class="contract-notes">
                            {% for note in contract.extension.contract_notes %}
                            <li>{{ note }}</li>
                            {% endfor %}
                        </ul>
                    </td>
                </tr>
                {% endif %}
                {% endif %}
                {% if contract.contract_notes and not contract.has_extension %}
                <tr class="notes-row">
                    <td colspan="4">
                        <ul class="contract-notes">
                            {% for note in contract.contract_notes %}
                            <li>{{ note }}</li>
                            {% endfor %}
                        </ul>
                    </td>
                </tr>
                {% elif contract.contract_notes and contract.has_extension %}
                <tr class="notes-row">
                    <td colspan="4">
                        <div style="color: var(--text-muted); font-size: 0.8rem; margin-bottom: 5px;">Current contract notes:</div>
                        <ul class="contract-notes">
                            {% for note in contract.contract_notes %}
                            <li>{{ note }}</li>
                            {% endfor %}
                        </ul>
                    </td>
                </tr>
                {% endif %}
                {% endfor %}
            </tbody>
        </table>

        <div class="contract-glossary">
            <h3>Contract Terms Glossary</h3>
            <dl>
                <dt>Bird Rights</dt>
                <dd>Named after Larry Bird. Allows teams to exceed the salary cap to re-sign their own players who have been on the roster for 3+ years. Enables offering larger contracts than other teams can.</dd>

                <dt>UFA (Unrestricted Free Agent)</dt>
                <dd>Player can sign with any team without restrictions. Their current team has no special rights to match offers.</dd>

                <dt>RFA (Restricted Free Agent)</dt>
                <dd>Player can receive offers from other teams, but their current team has the right to match any offer and retain the player.</dd>

                <dt>Player Option</dt>
                <dd>Player can choose to opt out of the final year(s) of their contract and become a free agent, or stay on the current deal.</dd>

                <dt>Club Option</dt>
                <dd>Team can choose whether to keep the player for an additional year at a set salary, or let them become a free agent.</dd>

                <dt>Designated Veteran Extension</dt>
                <dd>Also called "supermax." Allows teams to offer their best players contracts worth up to 35% of the salary cap. Limited to players meeting MVP/All-NBA criteria.</dd>

                <dt>Rookie Scale Contract</dt>
                <dd>Pre-set salaries for first-round draft picks based on draft position. Teams hold options for years 3 and 4.</dd>

                <dt>LTBE / ULTBE</dt>
                <dd><strong>Likely To Be Earned</strong> / <strong>Unlikely To Be Earned</strong> incentives. Bonuses based on performance benchmarks. "Likely" means player achieved it last season.</dd>

                <dt>TPE (Trade Player Exception)</dt>
                <dd>Created when a team trades away a player without taking salary back. Can be used to acquire players within one year.</dd>

                <dt>Sign-and-Trade</dt>
                <dd>Team signs their own free agent then immediately trades them. Allows the player to get a larger contract while moving to a new team.</dd>
            </dl>
        </div>

        <div class="contract-glossary">
            <h3>Salary Cap Terms Glossary</h3>
            <dl>
                <dt>Salary Cap</dt>
                <dd>A soft cap that limits team spending on player salaries. Teams can exceed it using various exceptions (Bird Rights, MLE, etc.) but face increasing penalties. For 2025-26: $154.6M.</dd>

                <dt>Luxury Tax Line</dt>
                <dd>Teams whose payroll exceeds this line must pay a tax to the league. The tax is progressive - the more you go over, the higher the rate. Tax payments are distributed to non-tax-paying teams. For 2025-26: $187.9M.</dd>

                <dt>First Apron</dt>
                <dd>A threshold above the luxury tax ($8M over). Teams above this face roster-building restrictions: cannot use the full mid-level exception, cannot aggregate salaries in trades, cannot acquire players via sign-and-trade. For 2025-26: $195.9M.</dd>

                <dt>Second Apron</dt>
                <dd>The harshest penalty tier ($19.9M above tax line). Teams above this lose their first-round pick if it would convey to another team, cannot take back more salary in trades, and face additional restrictions that make it very hard to improve the roster. For 2025-26: $207.8M.</dd>

                <dt>Hard Cap</dt>
                <dd>An absolute ceiling teams cannot exceed under any circumstances. Triggered by certain transactions like using the full MLE or sign-and-trades. The hard cap is set at the first apron level.</dd>

                <dt>Cap Hit vs Base Salary</dt>
                <dd>Cap hit is what counts against the salary cap (may include prorated bonuses, incentives). Base salary is the guaranteed amount the player receives. They can differ based on incentive structures.</dd>

                <dt>Mid-Level Exception (MLE)</dt>
                <dd>Allows teams over the cap to sign players for a set amount. Non-taxpayer MLE ($14.1M for 2025-26) is larger but triggers the hard cap. Taxpayer MLE ($5.7M) is smaller but doesn't trigger it.</dd>

                <dt>Cap Space</dt>
                <dd>Room between a team's current payroll and the salary cap. Teams with cap space can sign free agents outright. Most competitive teams operate over the cap using exceptions instead.</dd>
            </dl>
        </div>
        {% endif %}

        <div class="footer">
            Data from BALLDONTLIE API | <a href="/" style="color: var(--nuggets-gold);">Back to Main</a>
            <br><br>
            Last updated: {{ cache_time|mountain_time }}
        </div>
    </div>
</body>
</html>
